<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
	<title>Registrar Pago</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
		integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand btn btn-success" href="#" th:href="@{/pagosImpuestos}">Pagos Registrados
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
						class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
						<path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z" />
						<path
							d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466" />
					</svg>
				</a>
			</div>
		</div>
	</nav>
	<br>
	<div class="alert alert" th:if="${param.exito}" role="alert">
		<p>
			<h1>
				Pago Cotizado con Éxito!.
			</h1>
		</p>
		<div class="alert alert-info" role="alert" th:if="${session.placa}">
			Total a Cancelar: <strong th:text="'$' + ${session.valorTotal}"></strong>
			<br>
			Placa Registrada: <strong th:text="${session.placa}"></strong>
			<br>
			Propietario de Vehículo: <strong th:text="${session.propietario}"></strong>
			<br>
			Periodo a cancelar: <strong th:text="${session.anho}"></strong>
			
			</br></br>
			
			<a class="btn btn-primary btn-block" th:href="@{/nuevoContribuyente}">Realizar pago
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-paypal" viewBox="0 0 16 16">
				  <path d="M14.06 3.713c.12-1.071-.093-1.832-.702-2.526C12.628.356 11.312 0 9.626 0H4.734a.7.7 0 0 0-.691.59L2.005 13.509a.42.42 0 0 0 .415.486h2.756l-.202 1.28a.628.628 0 0 0 .62.726H8.14c.429 0 .793-.31.862-.731l.025-.13.48-3.043.03-.164.001-.007a.35.35 0 0 1 .348-.297h.38c1.266 0 2.425-.256 3.345-.91q.57-.403.993-1.005a4.94 4.94 0 0 0 .88-2.195c.242-1.246.13-2.356-.57-3.154a2.7 2.7 0 0 0-.76-.59l-.094-.061ZM6.543 8.82a.7.7 0 0 1 .321-.079H8.3c2.82 0 5.027-1.144 5.672-4.456l.003-.016q.326.186.548.438c.546.623.679 1.535.45 2.71-.272 1.397-.866 2.307-1.663 2.874-.802.57-1.842.815-3.043.815h-.38a.87.87 0 0 0-.863.734l-.03.164-.48 3.043-.024.13-.001.004a.35.35 0 0 1-.348.296H5.595a.106.106 0 0 1-.105-.123l.208-1.32z"/>
				</svg>
			</a>
		</div>
		<div class="alert alert-info">
			<p>
				Cada año se deprecia el vehículo en un 15 %
			<p>
		</div>
	</div>



	<div class="alert alert-danger" th:if="${param.errorContribuyente}" role="alert" style="z-index: 100;">
		<p>
			El contribuyente no se encuentra registrado!.
		</p>
	</div>

	<div class="alert alert-danger" th:if="${param.errorPlaca}" role="alert" style="z-index: 100;">
		<p>
			La placa no se encuentra registrada!.
		</p>
		<a class="btn btn-primary btn-block" th:href="@{/nuevoContribuyente}">Nuevo Contribuyente
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
				class="bi bi-person-plus-fill" viewBox="0 0 16 16">
				<path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
				<path fill-rule="evenodd"
					d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5" />
			</svg>
		</a>
		
		<a class="btn btn-primary btn-block" th:href="@{/nuevoVehiculo}">Nuevo Vehiculo
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
				class="bi bi-person-plus-fill" viewBox="0 0 16 16">
				<path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
				<path fill-rule="evenodd"
					d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5" />
			</svg>
		</a>
	</div>

	<div class="container">
		<div class="container">
			<div class="row">
				<div class="col-md-6 col-md-offset-3">

					<span class="input-group-text d-flex justify-content-between align-items-center"
						style="font-size: 20px;">
						<span>Datos del Vehiculo: &nbsp;<span></span></span>
					</span>
					</br>

					<form th:action="@{/registrarPago}" method="post" th:object="${pagoImpuesto}">
						<div class="form-group">
							<label class="control-label" for="idContribuyente" hidden>Número de Documento del
								Propietario:
							</label>
							<input id="idContribuyente" type="number" class="form-control" th:field="*{idContribuyente}"
								hidden required autofocus="autofocus">
						</div>
						<div class="form-group">
							<label class="control-label" for="idvehiculo">Placa del Vehiculo:</label>
							<div class="input-group">
								<input id="idvehiculo" maxlength="6" type="text" class="form-control"
									th:field="*{idvehiculo}" required autofocus="autofocus">
								<button type="button" class="btn btn-primary"
									onclick="filtrarPorPlaca()">Filtrar</button>
							</div>
						</div>

						<script>
							function filtrarPorPlaca() {
								var placa = document.getElementById("idvehiculo").value;

								console.log("Filtrar por placa:", placa);

								fetch(`/verAnhosPlaca?placa=${placa}`)
									.then(response => {
										if (!response.ok) {
											throw new Error('Hubo un problema al obtener los datos.');
										}
										return response.json();
									})
									.then(data => {
										mostraAnhos(data); // Pasar el modelo como argumento
										console.log("Modelo: " + data);
									})
									.catch(error => {
										console.error('Error:', error);
										window.location.href = "/nuevoPagoImpuesto?errorPlaca";
									});
							}



							function mostraAnhos(modelo) {

								if (modelo == null) {
									window.location.href = "/nuevoPagoImpuesto?errorPlaca";
								}
								var selectAnho = document.getElementById("anho");

								// Verificar que el modelo recibido es el mismo que se esperaba
								selectAnho.innerHTML = ""; // Limpiar opciones anteriores

								// Crear las opciones para el rango de años
								for (var year = modelo; year <= 2024; year++) {
									var option = document.createElement("option");
									option.value = year;
									option.text = year;
									selectAnho.appendChild(option);
								}
							}

						</script>


						<div class="form-group">
							<label class="control-label" for="ciudad">Ciudad : </label>
							<select id="ciudad" class="form-select" style="cursor: pointer;" th:field="*{ciudad}" required
								autofocus="autofocus">
								<option value="Bogotá">Bogotá</option>
								<option value="Cartagena">Cartagena</option>
								<option value="Cali">Cali</option>
								<option value="Medellin">Medellin</option>
								<option value="Bucaramanga">Bucaramanga</option>
							</select>
						</div>

						<div class="form-group">
							<label class="control-label" for="anho">Año : </label>
							<select id="anho" class="form-select" th:field="*{anho}" required autofocus="autofocus"
								data-modelo="__${modelo}__" style="cursor: pointer;">
								<!-- Opciones del select -->
							</select>

						</div>

						<br>

						<div class="form-group">
							<button type="submit" class="btn btn-success">Generar
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
									class="bi bi-floppy-fill" viewBox="0 0 16 16">
									<path
										d="M0 1.5A1.5 1.5 0 0 1 1.5 0H3v5.5A1.5 1.5 0 0 0 4.5 7h7A1.5 1.5 0 0 0 13 5.5V0h.086a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5H14v-5.5A1.5 1.5 0 0 0 12.5 9h-9A1.5 1.5 0 0 0 2 10.5V16h-.5A1.5 1.5 0 0 1 0 14.5z" />
									<path
										d="M3 16h10v-5.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5zm9-16H4v5.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5zM9 1h2v4H9z" />
								</svg>
							</button>
							<button type="reset" class="btn btn-secondary">Limpiar
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
									class="bi bi-eraser-fill" viewBox="0 0 16 16">
									<path
										d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z" />
								</svg>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
		integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.4/xlsx.full.min.js"></script>
</body>

</html>